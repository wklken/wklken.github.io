<!DOCTYPE html>
<html lang="en">

<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>Python-基础-文件处理小结</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="/theme/css/styles.css" media="all" />
        <link rel="stylesheet" href="/theme/css/tab.min.css" media="all" />
        <link rel="stylesheet" href="/theme/css/jquery-ui.min.css" media="all" />

        <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
        <!--
        <link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css">
        -->
        <!--[if IE 7]>
            <link rel="stylesheet" href="/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

</head>

<body>
    <div id="page" class="row">
        <div class="large-9 large-centered columns">

        <header id="header">
            <div class="constraint">
                <div class="o">
                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Building </span></h1></a>

                <div class="social">
                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                            <a href="http://www.wklken.me/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
                </div>
                <div class="nav">
                            <a href="/">首页</a>
                            <a href="/categories.html">分类</a>
                            <a href="/archives.html">归档</a>
                            <a href="/pages/projects.html">项目</a>
                            <a href="/pages/aboutme.html">关于</a>

                </div>

                </div>
            </div>
        </header><!-- /#banner -->

        <section id="main">


<article id="article">
    <section id="header">
        <!--
        <div class="meta">2013年03月16日</div>
        <h1 id="title"> Python-基础-文件处理小结 </h1>
        -->
        <div class="meta"> &nbsp; </div>
        <h1> Python-基础-文件处理小结 </h1>
    </section>

        <section id="toc">
            <div id="toc"><ul><li><a class="toc-href" href="#" title="Python-基础-文件处理小结">Python-基础-文件处理小结</a><ul><li><a class="toc-href" href="#_1" title="文件处理">文件处理</a><ul><li><a class="toc-href" href="#_2" title="文件模式">文件模式</a><ul><li><a class="toc-href" href="#mode" title="mode">mode</a></li><li><a class="toc-href" href="#bufsize" title="bufsize">bufsize</a></li></ul></li><li><a class="toc-href" href="#_4" title="文件对象属性">文件对象属性</a></li><li><a class="toc-href" href="#_5" title="文件操作">文件操作</a></li><li><a class="toc-href" href="#_6" title="最佳实践">最佳实践</a></li><li><a class="toc-href" href="#stringio" title="StringIO">StringIO</a></li><li><a class="toc-href" href="#pickle" title="pickle">pickle</a></li><li><a class="toc-href" href="#struct" title="struct">struct</a></li><li><a class="toc-href" href="#_7" title="其他相关模块">其他相关模块</a></li></ul></li></ul></li></ul></div>
        </section>
    <section id="content">
        <h2 id="_1">文件处理</h2>
<p>python常用，主要是用于文件操作，配合字符串操作，数值计算等，完成数据处理。</p>
<h3 id="_2">文件模式</h3>
<p>打开一个文件，返回一个文件对象。可以用open()或者file()，建议使用前者</p>
<div class="codehilite"><pre>file_object = open(file_name, access_mode = &lsquo;r&rsquo;, buffering = -1)
file_name：打开的文件名,若非当前路径，需指出具体路径
mode:可选参数，文件打开模式
bufsize:可选参数，是否使用缓存
</pre></div>
<h4 id="mode">mode</h4>
<div class="codehilite"><pre>模式      描述
r       以读方式打开文件，可读取文件信息.文件必须已存在
w       以写方式打开文件，可向文件写入信息。存在则清空，不存在创建
a       以追加方式打开文件，文件指针自动移到文件尾。追加
r+      以读写方式打开文件，可对文件进行读和写操作。
w+      消除文件内容，然后以读写方式打开文件。
a+      以读写方式打开文件，并把文件指针移到文件尾。
b       以二进制模式打开文件，而不是以文本模式。该模式只对Windows或Dos有效，类Unix的文件是用二进制模式进行操作的

U      通用换行符支持，任何系统下的文件, 不管换行符是什么, 使用U模式打开时, 换行符都会被替换为NEWLINE(\n)
</pre></div>
<p>+ 代表同时作为输入和输出文件，可以对相同文件进行读写</p>
<p>b代表二进制数据处理</p>
<p>和 r/w/a组合.
r+ 使用读写方式打开， rb二进制读</p>
<p>注意，在mode中使用b，b不能作为第一个字符出现</p>
<h4 id="bufsize">bufsize</h4>
<p>bufsize取值   描述</p>
<div class="codehilite"><pre>0   禁用缓冲
1   行缓冲，只缓冲一行
\&gt;1 指定缓冲区的大小，定制
&lt;1  系统默认的缓冲区大小,m默认
</pre></div>
<h3 id="_4">文件对象属性</h3>
<p>常用几个:</p>
<p>file.name 文件名</p>
<p>file.encoding文件使用编码,None 时使用系统默认编码</p>
<p>file.mode Access文件打开时使用的额访问模式</p>
<p>file.closed表文件已关闭，否则False</p>
<p>file.newlines未读取到分隔符时为None，包含行结束符的列表</p>
<p>file.softspace为0表示在输出一数据后，加上一空格，1表示不加，内部使用</p>
<div class="codehilite"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"a.py"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
<span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">mode</span>
<span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">encoding</span>
<span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">closed</span>
</pre></div>
<h3 id="_5">文件操作</h3>
<p>获取帮助</p>
<div class="codehilite"><pre><span class="nb">dir</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">help</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">)</span>
</pre></div>
<p>操作列表</p>
<div class="codehilite"><pre>#读
file.read(size=-1)       从文件读取size个字节，未给定或为负，读取所有
file.readline(size=-1)  读取并返回一行，或返回最大size个字符,包括\n
file.readlines(sizeint=0)   读取所有行并返回列表，若给定sizeint&gt;0，返回总和大约为sizeint字节的行, 实际读取值可能比sizhint较大, 因为需要填充缓冲区

#写
file.write(str)     向文件中写入字符串(文本或二进制)
file.writelines(seq)    写入多行，向文件中写入一个字符串列表，注意，要自己加入每行的换行符

#其他
file.seek(off,whence=0)     从文件中给移动指针，从whence(0起始，1当前，2末尾)偏移off个字节，正结束方向移动，负往开始方向移动
file.tell() 返回当前文件中的位置。获得文件指针位置
file.truncate(size=file.tell()) 截取文件到最大size个字节，默认为当前文件位置
file.close()    关闭打开的文件,垃圾回收机制也会在文件对象的引用计数降至0的时候自动关闭文件
file.fileno()    返回文件描述符(file descriptor FD 整型)是一个整数, 可以用在如os模块的read方法等一些底层操作上.
file.flush()    刷新文件内部缓冲,直接把内部缓冲区的数据立刻写入文件, 而不是被动的等待输出缓冲区写入.
file.isatty()   判断file是否是类tty设备
file.next()     返回文件下一行
</pre></div>
<h3 id="_6">最佳实践</h3>
<p>1.养成手动close</p>
<div class="codehilite"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'a.py'</span><span class="p">)</span>
<span class="err">&hellip;&hellip;</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>2.读取大文件</p>
<p>方法一:一次性读入,去左右空白+换行符，文件太大不建议这么做</p>
<div class="codehilite"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'bigdata'</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
<span class="err">&hellip;</span><span class="o">..</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>方法二:迭代</p>
<div class="codehilite"><pre><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'bigdata'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="err">&hellip;</span><span class="o">..</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>3.上下文管理器
用with，等价与上面方法二，注意不用显式close</p>
<div class="codehilite"><pre>&gt;&gt;&gt; with open('a.py') as f:
...     for line in f:
...         line = line.strip()
</pre></div>
<p>4.去除换行符/跳过空行</p>
<div class="codehilite"><pre><span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
    <span class="c1"># if line is empty</span>
    <span class="k">continue</span>            <span class="c1"># skip it</span>
</pre></div>
<h3 id="stringio">StringIO</h3>
<p>StringIO&ldquo;虚拟文件&rdquo;不是永久的</p>
<p>如果不保存它（如将它写入一个真正的文件，或者使用 shelve 模块或数据库），则程序结束时，它将消失</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">cStringIO</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fs</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="s1">'hello world'</span>
</pre></div>
<h3 id="pickle">pickle</h3>
<p>pickle任意python对象和字符串之间的序列化
类似java序列化存储到文件的过程</p>
<div class="codehilite"><pre><span class="c1"># encoding: utf-8</span>

<span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'a'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">'b'</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'datafile.pkl'</span><span class="p">,</span><span class="s1">'wb'</span><span class="p">)</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">'datafile.pkl'</span><span class="p">,</span><span class="s1">'rb'</span><span class="p">)</span>
<span class="n">e</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span> <span class="n">e</span>
</pre></div>
<h3 id="struct">struct</h3>
<p>能够构造并解析打包的二进制数据</p>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># encoding: utf-8</span>

<span class="kn">import</span> <span class="nn">struct</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'data.bin'</span><span class="p">,</span><span class="s1">'wb'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'hhl'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'data.bin'</span><span class="p">,</span><span class="s1">'rb'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">'hhl'</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="n">values</span>
</pre></div>
<h3 id="_7">其他相关模块</h3>
<div class="codehilite"><pre>base64  二进制字符串和文本字符串之间的编码/解码操作
binascii  二进制和ascii编码的二进制字符串间的编码/解码操作
bz2  访问BZ2格式的压缩文件
csv  访问csv文件(逗号分割文件)
filecmp   用于比较目录和文件
fileinput  提供多个文本文件的行迭代器
getopt/optparse  提供了命令行参数的解析/处理
glob/fnmatch  提供Unix样式的通配符匹配功能
gzip/zlib   读写GNU zip(gzip)文件(压缩需要zlib模块)
shutil  提供高级文件访问能力
c/StringIO   对字符串对象提供类文件接口
tarfile  读写TAR归档文件, 支持压缩文件
tempfile   创建一个临时文件(名)
uu  格式的编码和解码
zipfile  用于读取ZIP归档文件的工具
</pre></div>
<p>The end!</p>
<p>To be continue</p>
<p>wklken</p>
<p>Email: wklken@yeah.net</p>
<p>Blog:  http://blog.csdn.net/wklken</p>
<p>2013-03-16</p>
<p>转载请注明出处，谢谢</p>
    </section>

    <section id="copyright">
        <div class="copyright">
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        </div>

        <div class="donation">
            <center>
                <div style="width: 60%;">
                    <img src="/imgs/life/donation.png" style="float: left; width:50%;"/>
                    <img src="/imgs/life/donation_w.png" style="float: left; width:50%;"/>
                    <strong> 如果你觉得我的文章或项目对你有所帮助, 可小额捐赠 ¥0.99/¥2.99/¥4.99/¥9.9 用于站点维护:)</strong>
                </div>
            </center>

        </div>
    </section>


    <section id="neighbors">
        <div>
                        <a class="left" href="http://www.wklken.me/posts/2013/03/16/python-base-function.html">
                            上一篇:  Python-基础-函数小结
                        </a>
                        <a class="right" href="http://www.wklken.me/posts/2013/03/16/python-base-builtins.html">
                            下一篇: Python-基础-内置函数小结
                        </a>
        </div>
    </section>

    <section id="ad">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- blog_ad_003 -->
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-7635941258020589"
            data-ad-slot="7030416955"
            data-ad-format="auto"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

        <a href='http://www.vultr.com/?ref=6847203' target="_blank">
        <img src="/imgs/ads/vultr.png"> </img>
        </a>
    </section>



<section id="comments">
        <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_identifier = "posts/2013/03/16/python-base-file.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://wklken.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            </div>
</section>



</article>
        </section><!--end #main-->

            <footer class="row">
                <div class="large-12 columns">
                    <p>
                            Copyright © 2015 wklken <br>
                            Hosted on <a href="http://www.vultr.com/?ref=6847203"> vultr </a> Also <a href="https://www.digitalocean.com/?refcode=8ee73f2c47ce"> DigitalOcean </a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.
                    </p>
                </div>
            </footer>

            </div>
        </div>

        <section id="extras" class="body">
        </section><!-- /#extras -->



<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/jquery-scrollUp/2.1.0/jquery.scrollUp.min.js"></script>
<script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script>
    $(function(){
        $.scrollUp({
              scrollText: '', // Text for element, can contain HTML
            });
    });
</script>


<script type="text/javascript">
  /* var Swiftype = window.Swiftype || {}; */
  /* Swiftype.searchSearchFields = { */
    /* "page": ["title^10", "body"] */
  /* }; */

  /* (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){ */
  /* (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t); */
  /* e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e); */
  /* })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st'); */

  /* _st('install','v6K-_DamCeHvwX6z3o2F'); */
</script>



    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>




<div id="share">
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["mshare","tsina","weixin","douban","meilishuo","mogujie","youdao","sdo","mail","twi","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"right","bdTop":"96.5"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>



<script  src="http://www.wklken.me/theme/js/scroll-header.js" type="text/javascript"></script>




</body>
</html>