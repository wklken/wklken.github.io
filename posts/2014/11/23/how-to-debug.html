<!DOCTYPE html>
<html lang="en">

<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>关于代码调试de那些事</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="/theme/css/styles.css" media="all" />
        <link rel="stylesheet" href="/theme/css/tab.min.css" media="all" />
        <link rel="stylesheet" href="/theme/css/jquery-ui.min.css" media="all" />

        <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
        <!--
        <link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css">
        -->
        <!--[if IE 7]>
            <link rel="stylesheet" href="/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

</head>

<body id="index" class="home">
    <div id="page" class="row">
        <div class="large-9 large-centered columns">

        <header id="header">
            <div class="constraint">
                <div class="o">
                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Building </span></h1></a>

                <div class="social">
                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                            <a href="http://www.wklken.me/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
                </div>
                <div class="nav">
                            <a href="/">首页</a>
                            <a href="/categories.html">分类</a>
                            <a href="/archives.html">归档</a>
                            <a href="/pages/projects.html">项目</a>
                            <a href="/pages/aboutme.html">关于</a>

                </div>

                </div>
            </div>
        </header><!-- /#banner -->

        <section id="main">


<article id="article">
    <section id="header">
        <!--
        <div class="meta">2014年11月23日</div>
        <h1 id="title"> 关于代码调试de那些事 </h1>
        -->
        <div class="meta"> &nbsp; </div>
        <h1> 关于代码调试de那些事 </h1>
    </section>

        <section id="toc">
            <html><body><div id="toc"><ul><li><a class="toc-href" href="#" title="关于代码调试de那些事">关于代码调试de那些事</a><ul><li><a class="toc-href" href="#1" title="1.你得明白你在做什么, 保持清醒">1.你得明白你在做什么, 保持清醒</a></li><li><a class="toc-href" href="#2" title="2.想清楚了再写代码">2.想清楚了再写代码</a></li><li><a class="toc-href" href="#3" title="3.关于脚手架代码">3.关于脚手架代码</a></li><li><a class="toc-href" href="#4review" title="4.写完一段代码第一时间自己review一下">4.写完一段代码第一时间自己review一下</a></li><li><a class="toc-href" href="#5review" title="5.review中注意, 代码是抠过来的么?">5.review中注意, 代码是抠过来的么?</a></li><li><a class="toc-href" href="#6" title="6.搞明白问题的表现是什么(症状)">6.搞明白问题的表现是什么(症状)</a></li><li><a class="toc-href" href="#7" title="7.调试过程中, 需要时刻注意">7.调试过程中, 需要时刻注意</a></li><li><a class="toc-href" href="#8" title="8.环境/数据一致性">8.环境/数据一致性</a></li><li><a class="toc-href" href="#9" title="9.先不要动代码, 假设代码是正确的">9.先不要动代码, 假设代码是正确的</a></li><li><a class="toc-href" href="#10" title="10.首先要怀疑自己">10.首先要怀疑自己</a></li><li><a class="toc-href" href="#11" title="11.对于莫名其妙的问题, 多试几种情况">11.对于莫名其妙的问题, 多试几种情况</a></li><li><a class="toc-href" href="#12" title="12.先回到正确的代码">12.先回到正确的代码</a></li><li><a class="toc-href" href="#13" title="13.如果一段代码是没动过的代码">13.如果一段代码是没动过的代码</a></li><li><a class="toc-href" href="#14bug" title="14.bug总是倾向于集中出现在一起">14.bug总是倾向于集中出现在一起</a></li><li><a class="toc-href" href="#15" title="15.对于很长很长, 上二分法">15.对于很长很长, 上二分法</a></li><li><a class="toc-href" href="#16print-or-debug" title="16.print or debug?">16.print or debug?</a></li><li><a class="toc-href" href="#17" title="17.十分十分诡异的问题">17.十分十分诡异的问题</a></li><li><a class="toc-href" href="#18" title="18.当一个问题超过半小时">18.当一个问题超过半小时</a></li><li><a class="toc-href" href="#19google" title="19.关于google">19.关于google</a></li><li><a class="toc-href" href="#20" title="20.关于求助">20.关于求助</a></li><li><a class="toc-href" href="#21" title="21.吃一堑长一智">21.吃一堑长一智</a></li></ul></li></ul></div></body></html>
        </section>
    <section id="content">
        <p>写代码最完美的就是, 想清楚, 码, 运行, perfect, DONE, 下班.</p>
<p>当然, 那是完美的状态. 大多数时候只存在于理想中.</p>
<p>现实是, 我们会被各种坑, 被环境坑, 被语言坑, 被依赖坑, 被第三方库坑, 被编辑器坑, 被自己坑(三个月前的自己/昨天的自己/几分钟前的自己), 被数据库坑, 被缓存坑, 被队友坑(这个比较惨), 被需求变更坑(这个也是)......</p>
<p>所以, 总是避免不了代码调试.</p>
<p>今天顺带过了下&lt;&lt;想计算机科学家一样思考Python&gt;&gt;, 里面每一章最后都有关于调试的一些观点, 例如<code>阅读 - 深思 - 修改/运行/回退</code>, 所以决定来写写关于代码调试的一些东西.</p>
<p>其实, 代码调试是<code>论如何排查问题</code>的一个过程, 根据一切蛛丝马迹, 推断出问题所在, 并消灭之.(破案的即视感)</p>
<p><img alt="sherlock" src="/imgs/blabla/debug.png"/></p>
<p>下面是一些关于一些自己在写代码和调试的总结</p>
<hr/>
<h3 id="1">1.你得明白你在做什么, 保持清醒</h3>
<p>代码调试有时候会让你陷入无尽的自我怀疑/迷茫/愤怒/沮丧/窘迫/挫败(无限负能量), 很容易被这些情绪左右, 不清醒, 陷入怀疑自我(一定是我调用的方式不对), 或者怀疑一切(一定是数据库问题, 不对, 缓存问题, 不对, 接口问题, 好像不对, 数据问题), 或者胡乱改代码(改-跑-错了-再改-跑-又错-再改, 传说中的随机行走编程), 或者......(挣扎吧......)</p>
<p>此刻, 保持清醒的自我是非常重要的, 要明确: <code>我在做什么</code>, <code>问题是什么症状</code>, <code>原来逻辑是什么</code>, <code>最有可能出问题的是哪里</code>?</p>
<h3 id="2">2.想清楚了再写代码</h3>
<p>如果连需求是什么, 想要做什么都没整明白, 就吭哧吭哧开写, 意图在实践中摸索通向胜利的道路, 是很愚蠢的行为.</p>
<p>需要去理解需求, 自己要做什么, 然后, 在大脑中构造, 现在有什么, 为了完成需求需要做什么, 完成大体的组成结构/步骤流程的思考后, 再着手去做.</p>
<p>大到整体设计, 小到一个函数, 都可以这么处理</p>
<p>例如, 遇到复杂问题, 可以先写注释, 完整所有函数整体设计, 然后再填充细节</p>
<div class="codehilite"><pre>def dosomething():
        &ldquo;&rdquo;&rdquo;
        &ldquo;&rdquo;&rdquo;
        # step1: call func test()

        # step2: parse url to 

        # step3: judge

        # step4: convert and return
</pre></div>
<h3 id="3">3.关于<code>脚手架</code>代码</h3>
<p>在逻辑的关键位置, print/assert关键信息, 用于在调试中迅速确认问题. (一些中间值/状态/条件判断结果)</p>
<p>当然, 信息除了<code>关键</code>这个特性, 还需要足够<code>丰富</code>和<code>显眼</code>, 一遍一次性定位问题. (既要好看又要有用)</p>
<p>你需要确定下如何用顺手的编辑器快速输入这些代码, 可以用各类语言的snippets</p>
<p>例如, 在写python时候, 我很喜欢prt<tab>(k-vim自动补全), 快速插入一些需要的信息</tab></p>
<div class="codehilite"><pre>print "TRACK ================= result", type(result), result, result == "test"
</pre></div>
<h3 id="4review">4.写完一段代码第一时间自己review一下</h3>
<p>事实证明, review的效果比写完直接跑再来调, 效率高多了.</p>
<p>刚写完一段代码, 思路还很清晰, 跳到开始, review过程中注意各类变量, 条件判断, 函数调用, 上下文, 一致性, 错误处理等, 花不了多少时间, 却能发现一些<code>显而易见</code>的问题, 省下很多无谓的调试时间(没问题不需要调试!).</p>
<h3 id="5review">5.review中注意, 代码是<code>抠</code>过来的么?</h3>
<p>很多时候从其他地方copy代码过来(一行或几行, 有时候只是一个函数调用或一个判断), 但是很容易忘了根据当前情况修改一些必要的值, 导致问题</p>
<p>例如函数调用, 这个地方调用参数可能跟你copy这行代码需要参数不一样, 但是放在这里并不会报错(一切运作正常), 最终结果并不对.....</p>
<p>好了, 开始调试</p>
<h3 id="6">6.搞明白问题的表现是什么(症状)</h3>
<p>运行代码, 报错了, 有些人会瞬切回编辑器, 开始改代码(作高效状)......&gt;_&lt;#</p>
<p>问题是: <code>报错提示你看了么, 看明白了么?</code></p>
<p>现在大部分语言, 其报错提示已经很明显了, 精确到行/变量, 虽然整个异常栈信息可能很长(非常长), 但是都有其特征(在最前或在最后,或在中间靠后, 有关键字), 仔细看下报错信息, 精确制导才是王道.</p>
<p>所以, 你需要从错误信息中先确认</p>
<div class="codehilite"><pre>错误类型
发生错误的地方
</pre></div>
<p>很多语法问题可以根据这个信息直接定位</p>
<h3 id="7">7.调试过程中, 需要时刻注意</h3>
<p>改的是不是正确的目录下正确的文件?(大坑)</p>
<p>保存了么(编译了么)?(又一个坑)</p>
<p>服务重启了么?</p>
<p>跟数据库有没有关系/跟缓存有没有关系, 要不要清?</p>
<p>&hellip;&hellip;</p>
<p>以上问题, 随便碰上一个你都可能发现, 自己书写的代码和当前运行来调试的代码不一样.(会浪费你巨量的时间)</p>
<p>自己调试半天怎么还是一样的结果</p>
<p>我一直在修改, 但是没有什么区别(出现这种情况要自问一下了)</p>
<p>可以显示在代码头部打印或者故意出错, 确认是同一套代码</p>
<h3 id="8">8.环境/数据一致性</h3>
<p>当你发现在本地无法复现别人报过来的问题(在我电脑上是正常的), 这时候, 需要考虑是否是环境和数据的问题.</p>
<h3 id="9">9.先不要动代码, 假设代码是正确的</h3>
<p>遇到问题, 不要急着修改代码, 需要假设, 代码是正确的, 然后去复现, 复现之后定位.</p>
<h3 id="10">10.首先要怀疑自己</h3>
<p>你不能一旦代码跑不动就怀疑是别人的问题, 然后抛给别人, 这样做同样是很不负责任而且很愚蠢的.</p>
<p>首先, 你需要怀疑自己, 排查问题, 当确定不是自己的问题之后, 将问题定位, 输入, 预期结果, 现在的异常结果都处理好, 生成一个问题, 抛给对应负责人.
(一切没有价值的怀疑都是无意义的)</p>
<p>程序员都是好人, 每次都在想: <code>一定是我的问题</code></p>
<h3 id="11">11.对于莫名其妙的问题, 多试几种情况</h3>
<p>有时候碰上一些诡异的问题, 例如有一种情况的输入会报错, 这时候, 再跳过去修改代码前, 可以多尝试几种输入, 涉及边界/异常/正常等情况, 排除法, 精确制导.</p>
<p>例如, 可以变换输入值的范围(扩大或缩小, 可能用二分法), 变换输入类型和格式</p>
<h3 id="12">12.先回到<code>正确的代码</code></h3>
<p>如果这段代码是由于修改导致的, 可以注掉此次变更代码, 同样的输入再次验证定位</p>
<h3 id="13">13.如果一段代码是<code>没动过</code>的代码</h3>
<p>如果你确保<code>确实没动过</code>, 此时, 先不要怀疑自己, 更大的可能是<code>别人的问题</code>.</p>
<p>可能情况: 依赖出了问题(调用函数返回数据不对/异常? 依赖请求挂了? &hellip;&hellip;), 数据出了问题(表结构变更/服务返回数据变更), 环境问题(数据库/缓存)</p>
<h3 id="14bug">14.bug总是倾向于集中出现在一起</h3>
<p>很多时候, bug是扎堆的, 可以回忆下之前修改的地方, 确认问题.</p>
<h3 id="15">15.对于很长很长, 上<code>二分法</code></h3>
<p>可能函数很长, 或者调用链很长, 不易调试.(光打调试信息就得打得手疼)</p>
<p>找到关键变量, 上<code>二分法</code>, 无上利器.</p>
<h3 id="16print-or-debug">16.print or debug?</h3>
<p>个人偏好简单粗暴的<code>print</code>, 主要是用的vim+sinppet, 快速高效.</p>
<p>当然, 如果用IDE, 用   <code>debug</code>吧</p>
<h3 id="17">17.十分十分诡异的问题</h3>
<p>上<code>debug</code>, 打断点, 一点点调试吧, 只能这样了.</p>
<h3 id="18">18.当一个问题超过半小时</h3>
<p>歇一歇, 走动走动, 打个水, 呼吸下新鲜空气.</p>
<p>这时候有利于脱出情境, 去掉挫败感/愤怒/迷信等</p>
<p>很多时候突然灵感一到, 瞬间明了(这种感觉很奇妙)</p>
<h3 id="19google">19.关于google</h3>
<p>有些错误信息, 如果觉得比较独特诡异, 可以google下, 你会找到更多的一些信息的.</p>
<h3 id="20">20.关于求助</h3>
<p>实在搞不定, google大神也搞不定, 此时可能需要求助了.</p>
<p>前提, 你自己能把问题想清楚, 并且逻辑清晰地描述出来.(什么业务什么位置的什么逻辑, 报错类型和报错信息, 输入输出, 迄今做了哪些尝试等等) 要学会聪明地问问题, 高效, 尊重自己也尊重别人.</p>
<p>如果你自己都没整明白怎么问, 别人也无能为力.</p>
<p>遇到很多人, 直接上来就一句<code>xxx出问题了</code>, 没有前置条件后置结果中间症状......</p>
<p>不过, 如果你会聪明地问, 那就放心大胆地问吧, 不用磨磨唧唧的, 程序员大都是善良的孩子.</p>
<h3 id="21">21.吃一堑长一智</h3>
<p>被坑了就要总结总结, 有个记录, 不被同一个问题坑两次.</p>
<p>如果被坑了就忘, 还需要去反复求助, 那这属于坑队友的行为(鄙视下)</p>
<hr/>
<p>好了, 就这些:)</p>
    </section>

    <section id="copyright">
        <div class="copyright">
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        </div>

        <div class="donation">
            <center>
            <img src="/imgs/life/donation.png"/>
            <strong> 如果你觉得我的文章或项目对你有所帮助, You can buy me a coffee:) </strong>
            </center>
        </div>
    </section>


    <section id="neighbors">
        <div>
                        <a class="left" href="http://www.wklken.me/posts/2014/11/16/unit-statistics-system.html">
                            上一篇:  基于 PostgreSQL 的数据统计系统
                        </a>
                        <a class="right" href="http://www.wklken.me/posts/2014/11/30/pomodoro-technique-illustrated.html">
                            下一篇: 重读<<番茄时间工作法>>
                        </a>
        </div>
    </section>

<section id="comments">
        <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_identifier = "posts/2014/11/23/how-to-debug.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://wklken.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            </div>
</section>
</article>
        </section><!--end #main-->

            <footer class="row">
                <div class="large-12 columns">
                    <p>
                            Copyright © 2015 wklken <br>
                            Hosted on <a href="http://www.vultr.com/?ref=6847203"> vultr </a> . Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.
                    </p>
                </div>
            </footer>

            </div>
        </div>

        <section id="extras" class="body">
        </section><!-- /#extras -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



<script src="/theme/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
</body>
<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/jquery-scrollUp/2.1.0/jquery.scrollUp.min.js"></script>
<script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script>
    $(function(){
        $.scrollUp({
              scrollText: '', // Text for element, can contain HTML
            });
    });
</script>


<script type="text/javascript">
  /* var Swiftype = window.Swiftype || {}; */
  /* Swiftype.searchSearchFields = { */
    /* "page": ["title^10", "body"] */
  /* }; */

  /* (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){ */
  /* (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t); */
  /* e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e); */
  /* })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st'); */

  /* _st('install','v6K-_DamCeHvwX6z3o2F'); */
</script>



<div id="share">
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["mshare","tsina","weixin","douban","meilishuo","mogujie","youdao","sdo","mail","twi","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"right","bdTop":"96.5"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>



<script  src="http://www.wklken.me/theme/js/scroll-header.js" type="text/javascript"></script>


</html>