<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="Pythoné€šç”¨æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·">
<meta itemprop="description" content="å·²ç‹¬ç«‹æˆé¡¹ç›®åœ¨githubä¸Šé¢ dataformat æ¶‰åŠæ¨¡å— os, getopt, sys éœ€æ±‚ åœ¨è¿›è¡Œhadoopæµ‹è¯•æ—¶ï¼Œéœ€è¦é€ å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚æŸä¸ªè¡¨å­˜åœ¨56åˆ—ï¼Œä½†å®é™…ç¨‹åºé€»è¾‘åªé€‚ç”¨åˆ°æŸå‡ "><meta itemprop="datePublished" content="2011-12-10T08:00:00+08:00" />
<meta itemprop="dateModified" content="2011-12-10T08:00:00+08:00" />
<meta itemprop="wordCount" content="2832">
<meta itemprop="keywords" content="python," /><meta property="og:title" content="Pythoné€šç”¨æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·" />
<meta property="og:description" content="å·²ç‹¬ç«‹æˆé¡¹ç›®åœ¨githubä¸Šé¢ dataformat æ¶‰åŠæ¨¡å— os, getopt, sys éœ€æ±‚ åœ¨è¿›è¡Œhadoopæµ‹è¯•æ—¶ï¼Œéœ€è¦é€ å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚æŸä¸ªè¡¨å­˜åœ¨56åˆ—ï¼Œä½†å®é™…ç¨‹åºé€»è¾‘åªé€‚ç”¨åˆ°æŸå‡ " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wklken.me/posts/2011/12/10/python-dataformat.html" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-12-10T08:00:00+08:00" />
<meta property="article:modified_time" content="2011-12-10T08:00:00+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pythoné€šç”¨æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·"/>
<meta name="twitter:description" content="å·²ç‹¬ç«‹æˆé¡¹ç›®åœ¨githubä¸Šé¢ dataformat æ¶‰åŠæ¨¡å— os, getopt, sys éœ€æ±‚ åœ¨è¿›è¡Œhadoopæµ‹è¯•æ—¶ï¼Œéœ€è¦é€ å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚æŸä¸ªè¡¨å­˜åœ¨56åˆ—ï¼Œä½†å®é™…ç¨‹åºé€»è¾‘åªé€‚ç”¨åˆ°æŸå‡ "/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Pythoné€šç”¨æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·</title>
	<link rel="stylesheet" href="https://wklken.me/css/style.min.037b6ee8f8c1baab6a3d0a9da11c3ff18a7552471f16c59fd98538d5ce99208b.css" integrity="sha256-A3tu6PjBuqtqPQqdoRw/8Yp1UkcfFsWf2YU41c6ZIIs=" crossorigin="anonymous">
	
	<link rel="stylesheet" href="https://wklken.me/css/custom.css">
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://wklken.me">WKLKEN THINKING</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://wklken.me/posts.html">Posts</a>
				<a href="https://wklken.me/about.html">About</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/wklken" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://twitter.com/wklken" target="_blank" rel="noopener me" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://wklken.me/posts.html">Posts</a></li>
			<li><a href="https://wklken.me/about.html">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Dec 10, 2011</span></div>
				<h1>Pythoné€šç”¨æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·</h1>
			</header>
			<div class="content">
				<hr>
<p>å·²ç‹¬ç«‹æˆé¡¹ç›®åœ¨githubä¸Šé¢ <a href="https://github.com/wklken/dataformat">dataformat</a></p>
<hr>
<p>æ¶‰åŠæ¨¡å— os, getopt, sys</p>
<h3 id="éœ€æ±‚">éœ€æ±‚<a href="#éœ€æ±‚" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>åœ¨è¿›è¡Œhadoopæµ‹è¯•æ—¶ï¼Œéœ€è¦é€ å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚æŸä¸ªè¡¨å­˜åœ¨56åˆ—ï¼Œä½†å®é™…ç¨‹åºé€»è¾‘åªé€‚ç”¨åˆ°æŸå‡ åˆ—ï¼Œæˆ‘ä»¬é€ çš„æ•°æ® ä¹Ÿåªéœ€è¦æŸå‡ åˆ—</p>
<p>æ„é€ å‡ åˆ—æ•°æ®ï¼Œè½¬åŒ–ä¸ºå¯¹åº”æ•°æ®è¡¨æ ¼å¼</p>
<h3 id="æºä»£ç ">æºä»£ç <a href="#æºä»£ç " class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-
#dataformat.py
#   wklken@yeah.net
#this script change data from your source to the dest data format
#2011-08-05 created version0.1
#2011-10-29 add row-row mapping ,default row value .rebuild all functions. version0.2 
#next:add data auto generate by re expression
#2011-12-17 add new functions, add timestamp creator.  version0.3
#2012-03-08 rebuild functions. version0.4
#2012-06-22 add function to support multi output separators
#2012-07-11 fix bug  line 44,add if
#2012-09-03 rebuild functions,add help msg! version0.5
#2012-11-08 last version edited by lingyue.wkl
#           this py: https://github.com/wklken/pytools/blob/master/data_process/dataformat.py

import os
import sys
import getopt
import time
import re

#read file and get each line without \n
def read_file(path):
    f = open(path, &quot;r&quot;)
    lines = f.readlines()
    f.close()
    return [line[:-1] for line in lines ]

#å¤„ç†ä¸€è¡Œï¼Œè½¬ä¸ºç›®æ ‡æ ¼å¼ï¼Œè¿”å›ç›®æ ‡è¡Œ
def one_line_proc(parts, total, ft_map, outsp, empty_fill, fill_with_sno):
    outline = []
    #step1.è·å–æ¯ä¸€åˆ—çš„å€¼
    for i in range(1, total + 1):
        if i in ft_map:
            fill_index = ft_map[i]
            #åŠ å…¥ä½¿ç”¨é»˜è®¤å€¼åˆ—  è‹¥æ˜¯ä»¥då¼€å¤´ï¼Œåé¢æ˜¯é»˜è®¤ï¼Œå¦åˆ™å–æ–‡ä»¶å¯¹åº”åˆ— done
            if fill_index.startswith(&quot;d&quot;):
                #åˆ—é»˜è®¤å€¼æš‚ä¸å¼€å¯æ—¶é—´æˆ³å¤„ç†
                outline.append(fill_index[1:])
            else:
                outline.append(handler_specal_part(parts[int(fill_index) - 1]))
        else:
            #-s é€‰é¡¹ç”Ÿæ•ˆï¼Œå¡«å……åˆ—å·
            if fill_with_sno:
                outline.append(str(i))
            #å¦åˆ™ï¼Œå¡«å……é»˜è®¤å¡«å……å€¼
            else:
                outline.append(empty_fill)

    #step2.ç»„è£…åŠ å…¥è¾“å‡ºåˆ†éš”ç¬¦ï¼Œæ”¯æŒå¤šåˆ†éš”ç¬¦
    default_outsp = outsp.get(0,&quot;\t&quot;)
    result = []
    outsize = len(outline)
    for i in range(outsize):
        result.append(outline[i])
        if i &lt; outsize - 1:
            result.append(outsp.get(i + 1, default_outsp))
    #step3.æ‹¼æˆä¸€è¡Œè¿”å›
    return ''.join(result)

#å¤„ç†å…¥å£ï¼Œè¯»æ–‡ä»¶ï¼Œå¾ªç¯å¤„ç†æ¯ä¸€è¡Œï¼Œå†™å‡º
#è¾“å…¥æ•°æ®åˆ†éš”ç¬¦é»˜è®¤\t,è¾“å‡ºæ•°æ®é»˜è®¤åˆ†éš”ç¬¦\t
def process(inpath, total, to, outpath, insp, outsp, empty_fill, fill_with_sno, error_line_out):
    ft_map = {}
    #æœ‰æ•ˆè¾“å…¥å­—æ®µæ•°ï¼ˆå»é™¤é»˜è®¤å€¼åçš„ï¼‰
    in_count = 0
    used_row = []
    #step1-3ç›¸å½“äºæ•°æ®é¢„å¤„ç†ï¼Œè§£æä¼ å…¥é€‰é¡¹

    #step1 å¤„ç†æ˜ å°„åˆ— ä¸èƒ½å’Œç¬¬äºŒæ­¥åˆå¹¶
    for to_row in to:
        if r&quot;\:&quot; not in to_row and len(to_row.split(&quot;:&quot;)) == 2:
            used_row.append(int(to_row.split(&quot;:&quot;)[1]))
        if r&quot;\=&quot; not in str(to_row) and len(str(to_row).split(&quot;=&quot;)) == 2:
            pass
        else:
            in_count += 1

    #step2 å¤„ç†é»˜è®¤å€¼åˆ—
    for to_row in to:
        #å¤„ç†é»˜è®¤å€¼åˆ—
        if r&quot;\=&quot; not in str(to_row) and len(str(to_row).split(&quot;=&quot;)) == 2:
            ft_map.update({int(to_row.split(&quot;=&quot;)[0]): &quot;d&quot;+to_row.split(&quot;=&quot;)[1]})
            continue
        #å¤„ç†åˆ—åˆ—æ˜ å°„
        elif r&quot;\:&quot; not in to_row and len(to_row.split(&quot;:&quot;)) == 2:
            ft_map.update({int(to_row.split(&quot;:&quot;)[0]): to_row.split(&quot;:&quot;)[1]})
            continue
        #å…¶ä»–æ™®é€šåˆ—
        else:
            to_index = 0
            for i in range(1, total + 1):
                if i not in used_row:
                    to_index = i
                    break
            ft_map.update({int(to_row): str(to_index)})
            used_row.append(to_index)

    #setp3 å¤„ç†è¾“å‡ºåˆ†éš”ç¬¦   outsp  0=\t,1=    0ä»£è¡¨é»˜è®¤çš„ï¼Œå…¶ä»–å‰é¢å¸¦åˆ—å·çš„ä»£è¡¨æŒ‡å®šçš„
    if len(outsp) &gt; 1 and len(outsp.split(&quot;,&quot;)) &gt; 1:
        outsps = re.findall(r&quot;\d=.+?&quot;, outsp)
        outsp = {}
        for outsp_kv in  outsps:
            k,v = outsp_kv.split(&quot;=&quot;)
            outsp.update({int(k): v})
    else:
        outsp = {0: outsp}

    #step4 å¼€å§‹å¤„ç†æ¯ä¸€è¡Œ
    lines = read_file(inpath)
    f = open(outpath, &quot;w&quot;)
    result = []
    for line in lines:
        #å¤šä¸ªè¾“å…¥åˆ†éš”ç¬¦æƒ…å†µï¼Œä½¿ç”¨æ­£åˆ™åˆ‡åˆ†æˆåˆ—
        if len(insp.split(&quot;|&quot;)) &gt; 0:
            parts = re.split(insp, line)
        #å¦åˆ™ä½¿ç”¨æ­£å¸¸å­—ç¬¦ä¸²åˆ‡åˆ†æˆåˆ—
        else:
            parts = line.split(insp)

        #æ­£å¸¸çš„ï¼Œåˆ‡åˆ†åå­—æ®µæ•°å¤§äºç­‰äºé…ç½®çš„é€‰é¡¹ä¸ªæ•°
        if len(parts) &gt;= in_count:
            outline = one_line_proc(parts, total, ft_map, outsp, empty_fill, fill_with_sno)
            result.append(outline + &quot;\n&quot;)
        #ä¸æ­£å¸¸çš„ï¼Œåˆ—æ•°å°‘äºé…ç½®
        else:
            #è‹¥é…ç½®äº†-e è¾“å‡ºï¼Œå¦åˆ™åˆ—æ•°ä¸ç¬¦çš„è®°å½•è¿‡æ»¤
            if error_line_out:
                result.append(line + &quot;\n&quot;)

    #step5 è¾“å‡ºç»“æœ
    f.writelines(result)
    f.close()

#ç‰¹æ®Šçš„å¤„ç†å…¥å£ï¼Œå¤„ç†ç»´åº¦ä¸ºæ¯ä¸€è¡Œ,ç›®å‰åªæœ‰æ—¶é—´å¤„ç†
def handler_specal_part(part_str):
    #timestamp æ—¶é—´å¤„ç†
    #æ—¶é—´åˆ—ï¼Œé»˜è®¤å¿…é¡» TSæ•°å­—=æ—¶é—´
    if part_str.startswith(&quot;TS&quot;) and &quot;=&quot; in part_str:
        ts_format = {8: &quot;%Y%m%d&quot;,
                     10: &quot;%Y-%m-%d&quot;,
                     14: &quot;%Y%m%d%H%M%S&quot;,
                     19: &quot;%Y-%m-%d %H:%M:%S&quot;}
        to_l = 0
        #step1 ç¡®è®¤è¾“å‡ºçš„æ ¼å¼ TS8 TS10 TS14 TS19
        if part_str[2] != &quot;=&quot;:
            to_l = int(part_str[2:part_str.index(&quot;=&quot;)])

        part_str = part_str.split(&quot;=&quot;)[1].strip()
        interval = 0
        #step2 å­˜åœ¨æ—¶é—´+-çš„æƒ…å†µ ç¡®è®¤åŠ å‡åŒºé—´
        if &quot;+&quot; in part_str:
            inputdate = part_str.split(&quot;+&quot;)[0].strip()
            interval = int(part_str.split(&quot;+&quot;)[1].strip())
        elif &quot;-&quot; in part_str:
            parts = part_str.split(&quot;-&quot;)
            if len(parts) == 2: #20101020 - XX
                inputdate = parts[0].strip()
                interval = -int(parts[1].strip())
            elif len(parts) == 3: #2010-10-20
                inputdate = part_str
            elif len(parts) == 4: #2010-10-20 - XX
                inputdate = &quot;-&quot;.join(parts[:-1])
                interval = -int(parts[-1])
            else:
                inputdate = part_str
        else:
            inputdate = part_str.strip()
        #step3 å°†åŸå§‹æ—¶é—´è½¬ä¸ºç›®æ ‡æ—¶é—´
        part_str = get_timestamp(inputdate, ts_format, interval)

        #step4 å¦‚æœå®šä¹‰äº†è¾“å‡ºæ ¼å¼ï¼Œè½¬æ¢æˆç›®æ ‡æ ¼å¼ï¼Œè¿”å›
        if to_l &gt; 0:
            part_str = time.strftime(ts_format.get(to_l), time.localtime(int(part_str)))
    return part_str

#å°†æ—¶é—´ç”±ç§’è½¬åŒ–ä¸ºç›®æ ‡æ ¼å¼
def get_timestamp(inputdate, ts_format, interval=0):
    if &quot;now()&quot; in inputdate:
        inputdate = time.strftime(&quot;%Y%m%d%H%M%S&quot;) 
    inputdate = inputdate.strip()
    try:
        size = len(inputdate)
        if size in ts_format:
            ts = time.strptime(inputdate, ts_format.get(size))
        else:
            print &quot;the input date and time expression error,only allow 'YYYYmmdd[HHMMSS]' or 'YYYY-MM-DD HH:MM:SS'  &quot;
            sys.exit(0)
    except:
        print &quot;the input date and time expression error,only allow 'YYYYmmdd[HHMMSS]' or 'YYYY-MM-DD HH:MM:SS'  &quot;
        sys.exit(0)
    return str(int(time.mktime(ts)) + interval)

#æ‰“å°å¸®åŠ©ä¿¡æ¯
def help_msg():
    print(&quot;åŠŸèƒ½ï¼šåŸæ•°æ®æ–‡ä»¶è½¬ä¸ºç›®æ ‡æ•°æ®æ ¼å¼&quot;)
    print(&quot;é€‰é¡¹:&quot;)
    print(&quot;\t -i inputfilepath  [å¿…è¾“ï¼Œinput, åŸæ–‡ä»¶è·¯å¾„]&quot;)
    print(&quot;\t -t n              [å¿…è¾“ï¼Œtotal, nä¸ºæ•°å­—ï¼Œç›®æ ‡æ•°æ®æ€»çš„åŸŸä¸ªæ•°]&quot;)
    print(&quot;\t -a '1,3,4'        [å¿…è¾“ï¼Œarray, åŸŸç¼–å·å­—ç¬¦ä¸²ï¼Œé€—å·åˆ†éš”ã€‚æŒ‡å®šåŸŸç”¨åŸæ•°æ®å­—æ®µå¡«å……ï¼ŒæœªæŒ‡å®šç”¨'0'å¡«å……]&quot;)
    print(&quot;\t                          -a '3,5=abc,6:2'  ç¬¬5åˆ—é»˜è®¤å€¼abcå¡«å……,ç¬¬6åˆ—ä½¿ç”¨è¾“å…¥çš„ç¬¬1åˆ—å¡«å……ï¼Œç¬¬3åˆ—ä½¿ç”¨è¾“å…¥ç¬¬1åˆ—å¡«å……&quot;)
    print(&quot;\t -o outputfilepath [å¯é€‰ï¼Œoutput, é»˜è®¤ä¸º inputfilepath.dist ]&quot;)
    print(&quot;\t -F 'FS'           [å¯é€‰ï¼Œfield Sepï¼ŒåŸæ–‡ä»¶åŸŸåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º\\t,æ”¯æŒå¤šåˆ†éš”ç¬¦ï¼Œeg.'\t||\|' ]&quot;)
    print(&quot;\t -P 'OFS'          [å¯é€‰ï¼Œout FSï¼Œè¾“å‡ºæ–‡ä»¶çš„åŸŸåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º\\t,å¯æŒ‡å®šå¤šä¸ªï¼Œå¤šä¸ªéœ€æŒ‡å®šåºå·=åˆ†éš”ç¬¦,é€—å·åˆ†éš”,é»˜è®¤åˆ†éš”ç¬¦åºå·0 ]&quot;)
    print(&quot;\t -f 'fill_str'     [å¯é€‰ï¼Œfillï¼Œæœªé€‰åˆ—çš„å¡«å……å€¼ï¼Œé»˜è®¤ä¸ºç©º ]&quot;)
    print(&quot;\t -s                [å¯é€‰ï¼Œserial number,å½“é…ç½®æ—¶ï¼Œ-fæ— æ•ˆï¼Œä½¿ç”¨åˆ—å·å¡«å……æœªæŒ‡æ´¾çš„åˆ—]&quot;)
    print(&quot;\t -e                [å¯é€‰ï¼Œerror, æºæ–‡ä»¶åˆ—åˆ‡åˆ†ä¸ä¸€è‡´è¡Œ/ç©ºè¡Œ/æ³¨é‡Šç­‰ï¼Œä¼šè¢«ç›´æ¥è¾“å‡ºï¼Œæ­£ç¡®è¡ŒæŒ‰åŸé€»è¾‘å¤„ç†]&quot;)
    sys.exit(0)

#åˆ¤æ–­æŸä¸ªå‚æ•°å¿…é¡»è¢«å®šä¹‰
def must_be_defined(param, map, error_info):
    if param not in map:
       print error_info
       sys.exit(1)

#ç¨‹åºå…¥å£ï¼Œè¯»å…¥å‚æ•°ï¼Œæ‰§è¡Œ
def main():
    #init default value
    insp = &quot;\t&quot;
    outsp = &quot;\t&quot;
    empty_fill = ''
    fill_with_sno = False
    error_line_out = False
    #handle options
    try:
        opts,args = getopt.getopt(sys.argv[1:],&quot;F:P:tğŸ…°ï¸iâ­•f:hse&quot;)

        for op,value in opts:
          if op in (&quot;-h&quot;, &quot;-H&quot;, &quot;--help&quot;):
            help_msg()
          if op == &quot;-i&quot;:
            inpath = value
          elif op == &quot;-o&quot;:
            outpath = value
          elif op == &quot;-t&quot;:
            total = int(value)
          elif op == &quot;-a&quot;:
            to = value.split(&quot;,&quot;)
          elif op == &quot;-F&quot;:
            insp = value.decode(&quot;string_escape&quot;)
          elif op == &quot;-P&quot;:
            outsp = value.decode(&quot;string_escape&quot;)
          elif op == &quot;-f&quot;:
            empty_fill = value
          elif op == &quot;-s&quot;:
            fill_with_sno = True
          elif op == &quot;-e&quot;:
            error_line_out = True
        if len(opts) &lt; 3:
          print(sys.argv[0]+&quot; : the amount of params must great equal than 3&quot;)
          print(&quot;Command : ./dataformat.py -h&quot;)
          sys.exit(1)

    except getopt.GetoptError:
        print(sys.argv[0]+&quot; : params are not defined well!&quot;)
        print(&quot;Command : ./dataformat.py -h&quot;)
        sys.exit(1)

    params_map = dir()

    must_be_defined('inpath', params_map, sys.argv[0]+&quot; : -i param is needed,input file path must define!&quot;)
    must_be_defined('total', params_map, sys.argv[0]+&quot; : -t param is needed,the fields of result file must define!&quot;)
    must_be_defined('to', params_map, sys.argv[0]+&quot; : -a param is needed,must assign the field to put !&quot;)

    if not os.path.exists(inpath):
        print(sys.argv[0]+&quot; file : %s is not exists&quot;%inpath)
        sys.exit(1)

    if 'outpath' not in dir():
        outpath = inpath+&quot;.dist&quot;

    process(inpath, total, to, outpath, insp, outsp, empty_fill, fill_with_sno, error_line_out)

if __name__ ==&quot;__main__&quot;:
    main()
</code></pre>
<h3 id="ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜<a href="#ä½¿ç”¨è¯´æ˜" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>åŠŸèƒ½ï¼šå¯æŒ‡å®šè¾“å…¥åˆ†éš”ï¼Œè¾“å‡ºåˆ†éš”ï¼Œæ— é…ç½®å­—æ®µå¡«å……ï¼ŒæŸåˆ—é»˜è®¤å€¼,å¯æŒ‰é¡ºåºå¡«å……ï¼Œä¹Ÿå¯ä¹±åºæ˜ å°„å¡«å……</p>
<p>è¾“å…¥ï¼šè¾“å…¥æ–‡ä»¶è·¯å¾„</p>
<p>é€‰é¡¹ï¼š</p>
<pre><code>-i â€œpathâ€
å¿…è®¾
è¾“å…¥æ–‡ä»¶è·¯å¾„

-t n
å¿…è®¾
ç›®æ ‡æ•°æ®è¡¨æ€»åˆ—æ•°

-a â€œr1,r2â€
å¿…è®¾
å°†è¦å¡«å……çš„åˆ—å·åˆ—è¡¨ï¼Œå¯é…ç½®é»˜è®¤å€¼ï¼Œå¯é…ç½®æ˜ å°„

-o â€œpathâ€
å¯é€‰
è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸º è¾“å…¥æ–‡ä»¶è·¯å¾„.dist

-F â€œIFSâ€
å¯é€‰
è¾“å…¥æ–‡ä»¶ä¸­å­—æ®µåŸŸåˆ†éš”ç¬¦ï¼Œé»˜è®¤\t

-P â€OFSâ€
å¯é€‰
è¾“å‡ºæ–‡ä»¶ä¸­å­—æ®µåŸŸåˆ†éš”ç¬¦ï¼Œé»˜è®¤\t

-f â€œâ€
å¯é€‰
æŒ‡å®šæœªé…ç½®åˆ—çš„å¡«å……å†…å®¹ï¼Œé»˜è®¤ä¸ºç©º

-h
å•ç‹¬
æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
</code></pre>
<p>åˆ—å¡«å……çš„é…ç½®ç¤ºä¾‹ï¼š</p>
<p>æ™®é€šç”¨æ³•ã€æœ€å¸¸ç”¨ã€‘</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code>./dataformat.py â€“i in_file â€“t 65 -a â€œ22,39,63â€ â€“F â€œ^Iâ€ â€“P â€œ^Aâ€ â€“f â€œ0â€
</code></pre>
<p>è¯´æ˜ï¼š</p>
<pre><code>in_fileä¸­å­—æ®µæ˜¯ä»¥\tåˆ†éš”çš„[å¯ä¸é…-F,ä½¿ç”¨é»˜è®¤]ã€‚
å°†in_fileçš„ç¬¬1,2,3åˆ—åˆ†åˆ«å¡«å……åˆ°in_file.dist[use default]çš„ç¬¬22,39,63åˆ—
in_file.distå…±65åˆ—ï¼Œä»¥^Aåˆ†éš”ï¼Œæœªé…ç½®åˆ—ä»¥0å¡«å……
-aä¸­é¡ºåºä¸æºæ–‡ä»¶åˆ—åºæœ‰å…³ï¼Œè‹¥-a â€œ39,22,63â€ åˆ™æ˜¯å°†ç¬¬1åˆ—å¡«å……åˆ°ç¬¬39åˆ—ï¼Œç¬¬äºŒåˆ—å¡«å……åˆ°22åˆ—ï¼Œç¬¬3åˆ—å¡«å……åˆ°63åˆ—
</code></pre>
<p>åˆ—é»˜è®¤å€¼ç”¨æ³•:ã€éœ€è¦å¯¹æŸäº›åˆ—å¡«å……ç›¸åŒçš„å€¼ï¼Œä½†ä¸æƒ³åœ¨æºæ–‡ä»¶ä¸­ç»´æŠ¤ã€‘</p>
<p>å‘½ä»¤:</p>
<pre><code>./dataformat.py -i in_file â€“t 30 â€“a â€œ3=tag_1,9,7,12=0.0â€ â€“o out_file
</code></pre>
<p>è¯´æ˜:</p>
<pre><code>in_fileä»¥\tåˆ†éš”ï¼Œè¾“å‡ºout_fileä»¥\tåˆ†éš”
å°†in_fileçš„ç¬¬1åˆ—,ç¬¬2åˆ—å¡«å……åˆ°out_fileçš„ç¬¬9åˆ—ï¼Œç¬¬7åˆ—
out_fileå…±30åˆ—ï¼Œç¬¬3åˆ—å‡ç”¨å­—ç¬¦ä¸²â€tag_1â€å¡«å……ï¼Œç¬¬12åˆ—ç”¨0.0å¡«å……ï¼Œå…¶ä»–æœªé…ç½®åˆ—ä¸ºç©º
æ³¨æ„ï¼šé»˜è®¤å€¼ çš„å–å€¼ï¼Œè‹¥æ˜¯ä½¿ç”¨åˆ°ç­‰å·å’Œå†’å·ï¼Œéœ€è½¬ä¹‰ï¼ŒåŠ  \= \:
</code></pre>
<p>åˆ—åˆ—ä¹±åºæ˜ å°„ï¼š</p>
<p>å‘½ä»¤:</p>
<pre><code>./dataformat.py â€“i in_file â€“t 56 â€“a â€œ3:2,9,5:3,1=abc,11â€
</code></pre>
<p>è¯´æ˜:</p>
<pre><code>åˆ†éš”ï¼Œè¾“å…¥ï¼Œè¾“å‡ºï¼ŒåŒä¸Šâ€¦..
å†’å·å‰é¢ä¸ºè¾“å‡ºæ–‡ä»¶åˆ—å·ï¼Œåé¢ä¸ºè¾“å…¥æ–‡ä»¶åˆ—å·
ç›®æ ‡æ–‡ä»¶ç¬¬3åˆ—ç”¨è¾“å…¥æ–‡ä»¶ç¬¬2åˆ—å¡«å……ï¼Œç›®æ ‡æ–‡ä»¶ç¬¬5åˆ—ç”¨è¾“å…¥æ–‡ä»¶ç¬¬3åˆ—å¡«å……
ç›®æ ‡æ–‡ä»¶ç¬¬ä¸€åˆ—å‡å¡«å……â€œabcâ€
ç›®æ ‡æ–‡ä»¶ç¬¬9åˆ—ç”¨è¾“å…¥æ–‡ä»¶ç¬¬1åˆ—å¡«å……ï¼Œç¬¬11åˆ—ç”¨è¾“å…¥æ–‡ä»¶ç¬¬4åˆ—å¡«å……ã€æœªé…ç½®æ˜ å°„ï¼Œä½¿ç”¨ä»å¤´å¼€å§‹è¿˜æ²¡æœ‰è¢«ç”¨è¿‡çš„åˆ—ã€‘
è„šæœ¬ä¼šå¯¹ç®€å•çš„å­—æ®µæ•°é‡ç­‰æ˜ å°„é€»è¾‘è¿›è¡Œæ£€æµ‹ï¼Œå¤æ‚æœ€å¥½å…¨é…ä¸Šï¼Œä½¿ç”¨é»˜è®¤å¤ªæŠ½è±¡
</code></pre>
<p>ä»£ç æ‰˜ç®¡ä½ç½®  <a href="https://github.com/wklken/pytools/blob/master/data_process/dataformat.py">é“¾æ¥</a></p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://wklken.me/tags/python">python</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>2832 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2011-12-10 08:00 &#43;0800</p>
			</footer>
		</article>
		<aside id="toc">
			<div class="toc-title">Table of Contents</div>
			<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#éœ€æ±‚">éœ€æ±‚</a></li>
        <li><a href="#æºä»£ç ">æºä»£ç </a></li>
        <li><a href="#ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://wklken.me/posts/2011/12/10/python-ftp-ftplib.html">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Pythonå®ç°ftpå¸¸ç”¨æ“ä½œ[ftplib]</span>
			</a>
			<a class="prev-post" href="https://wklken.me/posts/2011/06/18/summary-01-leaveschool.html">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>è™½æœ‰é—æ†¾ï¼Œä¸æ›¾åæ‚”â€”â€”å†™åœ¨ç¦»æ ¡ä¹‹å‰</span>
			</a>
		</div>
		<div id="comments" class="thin">
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://wklken.me/js/md5.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: '549d325e74a413f1b56a',
    clientSecret: '086a83faacf152cc3f4079f002058716879e9688',
    repo: 'wklken.github.io',
    owner: 'wklken',
    admin: ['wklken'],
    id: md5(location.pathname), 
    distractionFreeMode: false 
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>

</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2022 <a href="https://wklken.me">wklken</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://wklken.me/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://wklken.me/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js" integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-42275748-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
